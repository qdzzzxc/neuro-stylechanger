## Telegram бот с обработкой картинок с помощью нейросетей
---
Данный проект представляет из себя пользовательский интерфейс на основе Telegram API, а также несколько алгоритмов, написанных с помощью PyTorch. 
Все части проекта разделены по контейнерам с помощью docker для лёгкого поддерживания и развёртывания на сервере. Для общения между контейнерами используется брокер сообщений NATS.
Бот доступен в мессенджере Telegram по ссылке: https://t.me/StyleChanger_bot

Пример работы бота:

![s1](https://github.com/qdzzzxc/neuro-stylechanger/assets/126320160/41b332a6-3ab5-4460-9c3d-4a178be0829c)
![s2](https://github.com/qdzzzxc/neuro-stylechanger/assets/126320160/52fef69c-7d71-4962-af39-5359d4ef27b5)

## Установка
---

***1) Клонируйте данный репозиторий***

```bash
git clone https://github.com/qdzzzxc/neuro-stylechanger
```

***2) Перейдите в директорию проекта и задайте все необходые параметры в файлах config.ini в папках bot и neuro.***

В каждой папке имеется файл config.example.ini, содержащий информацию о том, как должен выглядить конфигурационный файл.

***3) Запустите процесс сборки docker контейнеров, а затем запустите их.***
    
Убедитесь, что у вас установлены Docker и Docker Compose. В противном случае, установите их.

Саму сборку контейнеров можно запустить через команду
```bash
docker-compose build
```

Затем необходимо запустить созданные контейнеры через команду
```bash
docker-compose up
```
## Структура проекта

Весь проект состоит из трёх docker котнейнеров. Контейнер, для взаимодействия с Telegram API, для обработки изобраний с помощью torch, 
а также контейнер, ответственный за брокер сообщений NATS, использовавшийся для общения между двумя основынми контейнерами.

Директория bot: файлы, необходимые для работы бота и его взаимодействия с нейронной сетью.
Директория neuro: файлы, необходимые для запуска алгоритма и отправки обработанных изображений боту.

Директория jupyter: парсер, который я использовал для скачивания картин Валентина Серов, а также выполнения их первичной обработки. 
Также в этой директории находятся файлы, необходимые для обучения нейронной сети. Полученные во время обучения веса сохранены в директории weights.

### Телеграм бот

Бот написан с помощью фреймворка aiogram 3. Весь код, связанный с работой бота расположен в папке bot. 
Для хранения данных испольется json-файл, но паттерн data acces object, региструющий объект соединения через middleware,
позволяет легко заменить json формат на любой другой, например СУБД postgree или иную. 

### Нейронная сеть

Все алгоритмы глубокого обучения испульют PyTorch.

Реализован "медленный режим" Neural-Style. При использовании опции mode=cpu в конфигурации бота, он не используется из-за ограниченности ресурсов удалённого сервера. 
Для изучения и применения этого алгоритма использовалась эта статья: https://pytorch.org/tutorials/advanced/neural_style_tutorial.html. 

Также реализован CycleGAN, имплементация которого была взята со следующего репозитория: https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix.
Для применения в своём проекте, я переработал код, адаптировав его для работы с одной единственной картинкой на стадии деплоя бота. 
Для стадии обучения был оставлен только необходимый код, убраны отрисовка данных во время обучения в html и заменена на отрисовку прогерсса обучения через tdqm.
Во время обучения модели, я получил веса для генератора, которые позволяют воссоздавать стиль картин Валентина Серова. 
Веса, предоставленные в указанном репозитории, также использованы мной в работе бота и отвечают за стили других известных художников.
Сбор данных и их обработку я производил средствами библиотек lxml, requests и pillow.
Весь код для обучения и получения данных для обучения представлен в директории jupyter
